#!/bin/sh

# Настройка переменных окружения для бэкенда
export PORT=${PORT:-8081}

# Проверяем наличие файла конфигурации
if [ ! -f "/app/configs/config.json" ]; then
    echo "Ошибка: Файл конфигурации не найден!"
    exit 1
fi

# Стартуем бэкенд на порту 8081
echo "Запуск бэкенда на порту 8081..."
cd /app
/app/api &

echo "Проверка готовности бэкенда..."
# Даем бэкенду время на запуск
sleep 5

# Проверяем, запустился ли бэкенд
if ! ps aux | grep -v grep | grep "/app/api" > /dev/null; then
    echo "Ошибка: Бэкенд не запустился!"
    exit 1
fi

echo "Запуск Nginx на порту 8080..."
# Запускаем Nginx в фоновом режиме
nginx -g 'daemon off;' 